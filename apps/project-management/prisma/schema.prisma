generator client {
  provider = "prisma-client-js"
  output   = "../../../node_modules/.prisma/project-client"
  previewFeatures = ["driverAdapters", "multiSchema"]
}

datasource db {
  provider = "postgresql"
  schemas  = ["project"]
}

// Project Management Schema

model Project {
  id             String   @id @default(uuid())
  organizationId String
  name           String
  description    String?
  status         String
  startDate      DateTime?
  endDate        DateTime?
  budget         Decimal?
  metadata       Json?
  
  members        ProjectMember[]
  tasks          Task[]
  milestones     Milestone[]
  risks          RiskRegister[]
  aiInsights     AiInsight[]
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  deletedAt      DateTime?

  @@map("projects")
  @@schema("project")
}

model ProjectMember {
  id        String   @id @default(uuid())
  projectId String
  userId    String
  role      String?
  
  project   Project  @relation(fields: [projectId], references: [id])
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("project_members")
  @@schema("project")
}

model Task {
  id             String   @id @default(uuid())
  projectId      String
  parentId       String?
  assigneeId     String?
  title          String
  description    String?
  status         String
  priority       String?
  dueDate        DateTime?
  aiSuggestions  Json?
  
  project        Project  @relation(fields: [projectId], references: [id])
  parent         Task?    @relation("Subtasks", fields: [parentId], references: [id])
  subtasks       Task[]   @relation("Subtasks")
  
  checklists     TaskChecklist[]
  dependencies   TaskDependency[] @relation("TaskDependencies")
  dependentOn    TaskDependency[] @relation("TaskDependents")
  aiInsights     AiInsight[]
  
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  @@map("tasks")
  @@schema("project")
}

model TaskChecklist {
  id        String   @id @default(uuid())
  taskId    String
  item      String
  isCompleted Boolean @default(false)
  
  task      Task     @relation(fields: [taskId], references: [id])
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("task_checklists")
  @@schema("project")
}

model TaskDependency {
  id          String   @id @default(uuid())
  taskId      String
  dependsOnId String
  type        String
  
  task        Task     @relation("TaskDependencies", fields: [taskId], references: [id])
  dependsOn   Task     @relation("TaskDependents", fields: [dependsOnId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("task_dependencies")
  @@schema("project")
}

model Milestone {
  id          String   @id @default(uuid())
  projectId   String
  title       String
  description String?
  dueDate     DateTime?
  status      String
  
  project     Project  @relation(fields: [projectId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("milestones")
  @@schema("project")
}

model RiskRegister {
  id          String   @id @default(uuid())
  projectId   String
  description String
  probability String?
  impact      String?
  mitigationPlan String?
  status      String
  
  project     Project  @relation(fields: [projectId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("risk_register")
  @@schema("project")
}

model AiInsight {
  id          String   @id @default(uuid())
  projectId   String?
  taskId      String?
  content     String
  confidence  Float?
  actionable  Boolean  @default(false)
  
  project     Project? @relation(fields: [projectId], references: [id])
  task        Task?    @relation(fields: [taskId], references: [id])
  
  createdAt   DateTime @default(now())

  @@map("ai_insights")
  @@schema("project")
}
